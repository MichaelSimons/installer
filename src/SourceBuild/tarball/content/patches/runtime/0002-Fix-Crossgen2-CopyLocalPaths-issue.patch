From 8c604a6b314b160dee9387d007837a0425f25b73 Mon Sep 17 00:00:00 2001
From: dseefeld <dseefeld@microsoft.com>
Date: Fri, 3 Sep 2021 21:06:03 +0000
Subject: [PATCH] Fix Crossgen2 CopyLocalPaths issue

See https://github.com/dotnet/sdk/issues/20543
---
 .../Microsoft.NETCore.App.Crossgen2.sfxproj            | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/src/installer/pkg/sfx/Microsoft.NETCore.App/Microsoft.NETCore.App.Crossgen2.sfxproj b/src/installer/pkg/sfx/Microsoft.NETCore.App/Microsoft.NETCore.App.Crossgen2.sfxproj
index b039715be97..c9cbb579397 100644
--- a/src/installer/pkg/sfx/Microsoft.NETCore.App/Microsoft.NETCore.App.Crossgen2.sfxproj
+++ b/src/installer/pkg/sfx/Microsoft.NETCore.App/Microsoft.NETCore.App.Crossgen2.sfxproj
@@ -53,14 +53,18 @@
     <ItemGroup>
       <CrossgenFile Include="@(RuntimeFiles)" Condition="'%(Filename)' == 'crossgen'" />
       <OptimizationDataFile Include="@(RuntimeFiles)" Condition="'%(Filename)' == 'StandardOptimizationData'" />
-      <ReferenceCopyLocalPaths Include="@(RuntimeFiles)" Exclude="@(CrossgenFile);@(OptimizationDataFile)" />
-      <ReferenceCopyLocalPaths TargetPath="tools/" />
+      <ReferenceCopyLocalPaths Include="@(RuntimeFiles)" Exclude="@(CrossgenFile);@(OptimizationDataFile)">
+        <TargetPath>tools/%(RuntimeFiles.Filename)%(RuntimeFiles.Extension)</TargetPath>
+      </ReferenceCopyLocalPaths>
+      <ReferenceCopyLocalPaths DestinationSubDirectory="tools/" />
     </ItemGroup>
   </Target>
 
   <Target Name="AddFrameworkFilesToPackage" DependsOnTargets="ResolveLibrariesFromLocalBuild">
     <ItemGroup>
-      <ReferenceCopyLocalPaths Include="@(LibrariesRuntimeFiles)" TargetPath="tools/" />
+      <ReferenceCopyLocalPaths Include="@(LibrariesRuntimeFiles)" DestinationSubDirectory="tools/">
+        <TargetPath>tools/%(LibrariesRuntimeFiles.Filename)%(LibrariesRuntimeFiles.Extension)</TargetPath>
+      </ReferenceCopyLocalPaths>
     </ItemGroup>
   </Target>
 
-- 
2.31.1

